<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, minimum-scale=1, initial-scale=1, task-scalable=yes" name="viewport"/>
    <title>My Work</title>
    <link href="../../resources/fore.css" rel="stylesheet">
    <link href="../../resources/demo.css" rel="stylesheet">

    <script type="module" src="../demo.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
    <style>

        body {
            font-family: Montserrat, Verdana, sans-serif;
            padding: 2rem;
        }

        main {
            max-width: 64rem;
        }

        .litepicker .container__months .month-item:first-child .button-previous-month {
            visibility: hidden;
        }

        .litepicker .container__months .month-item:last-child .button-next-month {
            visibility: hidden;
        }

        .litepicker .container__days .day-item {
            color: var(--paper-grey-300);
        }

        .litepicker .container__days .day-item.is-in-range {
            background-color: var(--litepicker-is-in-range-color);
            border-radius: 0;
            color: var(--paper-grey-900);
        }


        h2 {
            display: flex;
            align-items: baseline;
            font-size: 1.5rem;
            grid-area: title;

            fx-trigger.iconbtn {
                margin-left: 0.5rem;
            }

            span {
                font-size: 1rem;
                padding-left: 1rem;
            }
        }

        .outer-card {
            display: grid;
            grid-template-areas:"title title"
                                "date list";
            grid-template-columns:18rem auto;
            position: relative;

        }

        .card {
            padding: 1rem;
            margin: 0.75rem 0;
            border-radius: 5px;
            border: thin solid #dddddd;
            background: white;
            display: grid;
            grid-template-areas: "task icon"
                                 "content content";
            position: relative;
        }

        fx-trigger {
            margin-left: 1.5rem;
        }

        details{
            /*width:10rem;*/
            /*position:absolute;*/
            right:0;
            /*display:none*/


            .details-content{
                padding:1rem;
                border:thin solid;
                margin-top:1rem;
                border-radius:0.25rem;
            }
            .details-content > *{
                margin:1rem 0;
            }
            fx-trigger{
                margin:0;
            }
        }

        details > summary {
            list-style-type: none;
            text-align: right;
            min-width:2rem;
        }

        /*
        summary::after {
            margin-left: 1ch
            display: inline-block;
            content: '\2630';
            transition: 0.2s;
        }
        */


        /*
        details[open] > summary::after {
            transform: rotate(90deg);
        }
        */
        #category {
            input {
                font-size: 1.4rem;
                border: none;
                border-radius: 0;
                width: calc(100% - 2rem);
            }
        }

        fx-trigger.iconbtn {
            display: inline-flex;
            align-items: center;

            button {
                border-radius: 50%;
                color: black;
                background: white;
                border: thin solid #636060;
                width: 1.5rem;
                height: 1.5rem;
                font-size: 1.1rem;
            }

            button:hover {
                background: grey;
                color: white;
                z-index: 100;
            }


        }

        .card-content {
            grid-area: content;
        }

        #period {
            border: thin solid var(--paper-grey-300);
            border-radius: 1rem;
            position: relative;
            padding: 2rem;

            > div:nth-child(1) {
                margin-bottom: 1rem;
            }

            > div:nth-child(2) {
                margin-top: 1rem;
            }

        }

        label {
            display: block;
        }

        [repeat-index] {
            background: rgba(255, 255, 255, 0.5);

            /*
            &> .more-actions{
                display:inline-block;
            }
            */
        }

        .drag-over {
            background: #efefef;
            outline: thin solid blue;
        }


        fx-control {
            width: 100%;
            position: relative;
        }

        .dateCtrl {
            width: 8rem;
        }

        fx-fore {
            height: 100vh;
        }

        fx-repeat {
            position: relative;
            width: calc(100% - 2rem);

            .iconbtn {
                width: 2rem;
            }

            fx-control {

                width: calc(100% - 3rem);
                display: inline-block;
            }

            fx-repeatitem {
                max-width: 100%;
                padding: 1rem;

                .deletebtn {
                    position: absolute;
                    left: -2rem;
                    top: 1.3rem;

                    a, a:link, a:visited {
                        text-decoration: none;
                        display: inline-block;
                        border-radius: 50%;
                        padding: 0.1rem 0.25rem;
                    }

                    a:hover {
                        background: var(--paper-red-700);
                        color: white;
                    }

                }

                /*
                [repeat-index]{
                    outline:solid thin #ddd;
                }
                */

                /*
                fx-repeatitem.drag-over {
                    outline: 0.25rem solid orange;
                }
                */


            }

            #r-task {
                padding: 1rem;

                fx-control:has([type=checkbox]) {
                    width: 2rem;
                }

                fx-repeatitem {
                    width: 100%;
                    padding: 0.25rem 0;
                    display: flex;

                    [type=date] {
                        /*width:5rem;*/
                    }

                    fx-output {
                        white-space: nowrap;
                    }
                }


                input {
                    border: none;
                }

                .task-true input {
                    text-decoration: line-through;
                }
            }


            /*
            .ghost{
                height:3rem;
                background: #dddddd;
            }
            */

            input {
                width: calc(100% - 0.5rem);
                border: thin solid #dddddd;
                padding: 4px;
                background: white;
                font-size: 1rem;
                border-radius: 0.2rem;
            }

            /* project repeat */


            /*
            .card .iconbtn button:hover {
                background: darkred;
            }

            .iconbtn.addperiod:hover {
                z-index: 20;
            }
            */


            .deleteProject {
                right: 2rem;
                position: absolute;
            }


            .addProject {
                right: 0.5rem;
            }

            /*
            .iconbtn.addperiod {
                right: 2.5rem;
            }
            */


            header {
                padding: 1rem 0;
            }

            .header {
                /* border-bottom: thin solid white; */
                padding: 1rem;
                display: flex;
                align-items: center;
            }

            .header input {
                background: var(--paper-light-blue-500);
                border-radius: 1rem;
                width: 80px;
                color: white;
                text-align: center;
            }

            .header.doing input {
                background: var(--paper-orange-500);
            }

            .header.done input {
                background: var(--paper-green-500);
            }

            /*
            #period > fx-repeatitem {
                background: var(--paper-grey-100);
                position: relative;
                min-width: 300px;
                padding: 0.5rem 0.25rem;
                width: 100%;
            }
            */

            #period > [repeat-index] {
                border: thin solid var(--paper-grey-500);
            }

            #period .header > fx-control {
                width: calc(100% - 5rem);
            }

            .handle {
                width: 2rem;
                right: 0.5rem;
                padding-right: 1rem;
                cursor: grabbing;
                height: 2rem;
            }

            .line {
                background: black;
                display: block;
                height: 1px;
                width: 100%;
                margin-bottom: 4px;
            }

            .subheader {
                font-size: 0.9rem;
                font-weight: 700;
                margin-top: 1rem;
            }

            .activity {
                width: 100%;
                display: block;
            }


            .priority:before {
                /*color:white;*/
                width: 16px;
                height: 16px;
                padding: 2px;
                display: inline-block;
                text-align: center;
                border-radius: 14px;
                content: '';
            }

            .priority.p1:before {
                /*content:'highest';*/
                background: red;
            }

            .priority.p2:before {
                /*content:'high';*/
                background: orange;
            }

            .priority.p3:before {
                /*content:'medium';*/
                background: dodgerblue;
            }

            .priority.p4:before {
                /*content:'forget it';*/
                background: green;
            }

            /*
            .iconbtn {
                width: 1rem;
                height: 1rem;
            }
            */

            /*
            #r-task .iconbtn button {
                font-size: 0.75rem;
                padding: 0.25rem 0.5rem;
            }
            */

            .wrapper {
                width: auto;
                max-width: 100%;
            }

            .margin-top {
                padding-top: 2rem;
            }

            .margin-bottom {
                padding-bottom: 2rem;
            }

            .more-actions {
                /*width: 10rem;*/
                /*display: none;*/

                a, a:link, a:visited {
                    text-decoration: none;
                }
            }



            fx-control, input {
                width: 100%;
            }
        }

        .up::before {
            content: '';
            height: 3rem;
            background: #dddddd;
            border: thin solid #666666;
            width: 100%;
        }

        .down::after {
            content: '';
            height: 3rem;
            background: pink;
            border: thin solid #666666;
            width: 100%;
        }

        #searchCtl {
            padding: 0.5rem;
            max-width: 59.25rem;
        }

        /*
        #r-category fx-repeatitem {
            display:flex;
            align-items:center;
            cursor: grabbing;
            flex-wrap:wrap;
        }
        */


        .match {
            background-color: orange;
            border-color: darkorange;
            border-width: medium;
        }

    </style>
</head>
<body>
<fore-corner href="../doc/demos.html" title="Back to Demos"></fore-corner>
<fx-fore>
<!--
    <fx-action event="keydown" phase="capture" perform="default" target="#window" if="event('code') = 'Backspace'">
        <fx-message>backspace empty {event('target.value') = ''}</fx-message>
    </fx-action>
-->
<fx-action event="click">
    <fx-call function="close-details()"></fx-call>
</fx-action>
    <fx-model>
        <fx-functionlib src="realtime-functions.html"></fx-functionlib>
        <fx-instance>
            <data>
                <period name="thisweek" start="" end="">
                    <category name="IB">
                        <task owner="me" done="true">Open file handles</task>
                        <task owner="me" done="true">fix util:string-to-binary</task>
                        <task owner="me" done="false">provide lib version of 6.2.1</task>
                        <task owner="me" done="true">Tests</task>
                        <task owner="me" done="false">review IB Budgets</task>
                    </category>
                    <category name="BetamasaHeft">
                        <task owner="me" done="false">Publisher Integration</task>
                    </category>
                </period>
                <period name="nextweek">
                    <category name="art-decor">
                        <task owner="me" done="false">fix bug xyz</task>
                    </category>
                </period>
                <period name="thismonth">
                    <category name="eXist-db">
                        <task owner="me" done="false">Publisher Integration</task>
                    </category>
                </period>
                <period name="nextmonth">
                </period>
                <template>
                    <category name=""></category>
                    <task done="false"></task>
                </template>
            </data>
        </fx-instance>
        <fx-bind ref="instance()/period/category/task">
            <fx-bind ref="@due" relevant=". != ''"></fx-bind>
        </fx-bind>
        <fx-instance id="vars">
            <data>
                <search></search>
                <owner>me</owner>
                <more-actions>false</more-actions>
            </data>
        </fx-instance>
        <fx-var name="vars" value="instance('vars')"></fx-var>

        <!--
                <fx-function signature="today() as xs:string" type="text/javascript">
                    return new Date().toISOString().slice(0, 10);
                </fx-function>
        -->
        <fx-function signature="get-month($start as xs:string) as xs:string"
                     type="text/javascript">
            const date = new Date($start);
            return date.getMonth();
        </fx-function>
        <fx-function signature="close-details() as xs:boolean"
                     type="text/javascript">
            const details = document.querySelectorAll('details');
            Array.from(details).forEach(d => {
                d.removeAttribute('open');
            });
            return true;
        </fx-function>

    </fx-model>
    <h1>My Work {today()}</h1>
    <main>
        <!--
                <header>
                    <fx-control ref="instance('vars')/search" update-event="input">
                        <label for="searchCtl">Search</label>
                        <input id="searchCtl" type="search" placeholder="input a search term - at least 2 characters">
                    </fx-control>
                </header>
        -->
        <section class="outer-card">
            <h2>THIS WEEK</h2>
            <div class="dateDisplay">
                <input id="startperiod" type="hidden" value="{dayOfWeekISO('last','wednesday')}">
                <input id="endperiod" type="hidden" value="{dayOfWeekISO('next','wednesday')}">
            </div>
            <fx-group id="period" ref="period[@name='thisweek']">
                <fx-repeat id="r-category" ref="category" tabindex="0">
                    <template draggable="true" drop-target="r-category">

                        <fx-trigger class="deletebtn">
                            <a href="#">&#x2715;</a>
                            <fx-delete ref="."></fx-delete>
                        </fx-trigger>

                        <fx-control id="category" ref="@name">
                            <input placeholder="project or category?">
                        </fx-control>

                        <fx-repeat id="r-task" ref="task">
                            <template draggable="true" drop-target="r-task">
                                <fx-control ref="@done" value-prop="checked" update-event="input">
                                    <input type="checkbox" class="widget">
                                </fx-control>
                                {@done}
                                <fx-control class="task-{@done}" id="task" class="task" ref=".">
                                    <input placeholder="specify the task">
                                </fx-control>
<!--
                                <fx-trigger class="more-actions">
                                    <a href="#">...</a>
                                    <fx-toggleboolean ref="instance('vars')/more-actions">true</fx-toggleboolean>
                                </fx-trigger>
                                <div class="action-details-{instance('vars')/more-actions}">
                                    <fx-trigger>
                                        <a href="#">delete</a>
                                        <fx-action>
                                            <fx-delete ref="."></fx-delete>
                                        </fx-action>
                                    </fx-trigger>
                                </div>
-->
<!--
                                <details>
                                    <summary>...</summary>
                                    <div class="details-content">
                                        <fx-control class="dateCtrl" id="due" ref="@due" create update-event="input">
                                            <label>Due
                                                <input type="date"/>
                                            </label>
                                        </fx-control>
                                        <fx-trigger>
                                            <a href="#">delete</a>
                                            <fx-action>
                                                <fx-delete ref="."></fx-delete>
                                            </fx-action>
                                        </fx-trigger>
                                    </div>
                                </details>
-->

                                <!--
                                                                <fx-control class="dateCtrl" id="due" ref="@due" update-event="input">
                                                                    <input type="date"/>
                                                                    <fx-action event="value-changed">
                                                                        <fx-toggle case="c-default"></fx-toggle>
                                                                    </fx-action>
                                                                </fx-control>
                                -->

                                <!--
                                todo: not working - why?
                                                                <fx-trigger ref="not(exists(./@due))">-->



                                <!-- todo: this is where i'd like to have a way to get access to the calling dom element aka 'this' or 'event.target'
                                   In this case i only the want to change the DOM without actually binding that to data.
                               -->

                                <!--
                                                        <details class="more-actions">

                                                            <summary>
                                                                <fx-trigger>
                                                                    <button>...</button>
                                                                    <fx-call function="toggleDetails(event('target'))"></fx-call>
                                                                </fx-trigger>
                                                            </summary>
                                                            <fx-trigger>
                                                                <a href="#">due</a>
                                                                <fx-action>
                                                                    <fx-setattribute ref="." name="due" value=""></fx-setattribute>
                                                                    <fx-setfocus control="due"></fx-setfocus>
                                                                </fx-action>
                                                            </fx-trigger>
                                                        </details>
                                -->

                            </template>
                        </fx-repeat>
                        <fx-trigger class="" title="add card">
                            <a href="#">add task</a>
                            <fx-action>
                                <fx-insert ref="task" origin="instance()/template/task"></fx-insert>
                                <!--                        <fx-setfocus control="category" delay="300"></fx-setfocus>-->
                            </fx-action>
                        </fx-trigger>

                    </template>
                </fx-repeat>

                <fx-trigger class="" title="add card">
                    <a href="#">add category</a>
                    <fx-action>
                        <fx-insert context="period[@name='thisweek']" ref="category"
                                   origin="instance()/template/category"></fx-insert>
                        <fx-setfocus control="category" delay="300"></fx-setfocus>
                    </fx-action>
                </fx-trigger>

            </fx-group>
            <!--            <fx-droptarget></fx-droptarget>-->
        </section>
        <!--
                <section>
                    <h2>next week {next-day(dayOfWeek('next','wednesday'))} -
                        {in-one-week(next-day(dayOfWeek('next','wednesday')))}
                        <fx-trigger class="iconbtn" title="add card">
                            <button>+</button>
                            <fx-action>
                                <fx-insert ref="period[@name='nextweek']/category"
                                           origin="instance()/template/category"></fx-insert>
                            </fx-action>
                        </fx-trigger>
                    </h2>
                    <fx-group id="period" ref="period[@name='nextweek']">
                        <fx-repeat id="r-category" ref="category" tabindex="0">
                            <template draggable="true" drop-target="r-category">

                                <fx-trigger class="iconbtn" title="add card">
                                    <button>+</button>
                                    <fx-action>
                                        <fx-insert ref="task" origin="instance()/template/task"></fx-insert>
                                        &lt;!&ndash;                        <fx-setfocus control="category" delay="300"></fx-setfocus>&ndash;&gt;
                                    </fx-action>
                                </fx-trigger>

                                <fx-control id="category" ref="@name">
                                    <input placeholder="project or category?">
                                </fx-control>

                                <fx-repeat id="r-task" ref="task">
                                    <template draggable="true" drop-target="r-task">
                                        <fx-control ref="./@done" value-prop="checked" update-event="input">
                                            <input type="checkbox">
                                        </fx-control>
                                        <fx-control id="task" class="task" ref=".">
                                            <input placeholder="specify the task">
                                        </fx-control>
                                    </template>
                                </fx-repeat>
                            </template>
                        </fx-repeat>
                    </fx-group>
                </section>
        -->
        <!--
                <section>
                    <h2>{this-month()}
                        <fx-trigger class="iconbtn" title="add card">
                            <button>+</button>
                            <fx-action>
                                <fx-insert ref="period[@name='thismonth']/category"
                                           origin="instance()/template/category"></fx-insert>
                                <fx-focus control="category"></fx-focus>
                            </fx-action>
                        </fx-trigger>
                    </h2>
                    <fx-group id="period" ref="period[@name='thismonth']">
                        <fx-repeat id="r-category" ref="category" tabindex="0">
                            <template draggable="true" drop-target="r-category">

                                <fx-trigger class="iconbtn" title="add card">
                                    <button>+</button>
                                    <fx-action>
                                        <fx-insert ref="task" origin="instance()/template/task"></fx-insert>
                                        &lt;!&ndash;                        <fx-setfocus control="category" delay="300"></fx-setfocus>&ndash;&gt;
                                    </fx-action>
                                </fx-trigger>

                                <fx-control id="category" ref="@name">
                                    <input placeholder="project or category?">
                                </fx-control>

                                <fx-repeat id="r-task" ref="task">
                                    <template draggable="true" drop-target="r-task">
                                        <fx-control ref="./@done" value-prop="checked" update-event="input">
                                            <input type="checkbox">
                                        </fx-control>
                                        <fx-control id="task" class="task" ref=".">
                                            <input placeholder="specify the task">
                                        </fx-control>
                                    </template>
                                </fx-repeat>
                            </template>
                        </fx-repeat>
                    </fx-group>
                </section>
        -->
        <!--
                <section>
                    <h2>{next-month()}
                        <fx-trigger class="iconbtn" title="add card">
                            <button>+</button>
                            <fx-action>
                                <fx-insert context="period[@name='nextmonth']" ref="category"
                                           origin="instance()/template/category"></fx-insert>
                            </fx-action>
                        </fx-trigger>
                    </h2>
                    <fx-group id="period" ref="period[@name='nextmonth']">
                        <fx-repeat id="r-category" ref="category" tabindex="0">
                            <template draggable="true" drop-target="r-category">

                                <fx-trigger class="iconbtn" title="add card">
                                    <button>+</button>
                                    <fx-action>
                                        <fx-insert ref="task" origin="instance()/template/task"></fx-insert>
                                        &lt;!&ndash;
                                        <fx-setfocus control="category" delay="300"></fx-setfocus>&ndash;&gt;
                                    </fx-action>
                                </fx-trigger>

                                <fx-control id="category" ref="@name">
                                    <input placeholder="project or category?">
                                </fx-control>

                                <fx-repeat id="r-task" ref="task">
                                    <template draggable="true" drop-target="r-task">
                                        <fx-control ref="./@done" value-prop="checked" update-event="input">
                                            <input type="checkbox">
                                        </fx-control>
                                        <fx-control id="task" class="task" ref=".">
                                            <input placeholder="specify the task">
                                        </fx-control>
                                    </template>
                                </fx-repeat>
                            </template>
                        </fx-repeat>
                    </fx-group>
                </section>
        -->

        </section>
    </main>
</fx-fore>
<script>
    document.addEventListener('ready', e => {
        console.log('ready')
        window.disableLitepickerStyles = true;

        const element = document.getElementById('startperiod');
        const elementEnd = document.getElementById('endperiod');
        console.log('ready', element)
        const picker = new Litepicker({
            element: element,
            elementEnd: elementEnd,
            inlineMode: true,
        });
    });
</script>

</body>
</html>
